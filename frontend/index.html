<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CNC AI - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© Ù…Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <style>
    :root {
      --primary-color: #4a90e2;
      --secondary-color: #67b0f5;
      --bg-color: #f8f9fa;
      --text-color: #212529;
      --card-bg: #ffffff;
      --border-color: #dee2e6;
      --header-bg: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      --header-text: #ffffff;
      --button-bg: #e9ecef;
      --button-hover: #dee2e6;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --error-color: #dc3545;
      --ai-color: #9c27b0;
      --wood-color: #8b4513;
      --tab-inactive: #e9ecef;
      --tab-active: var(--primary-color);
      --analysis-color: #17a2b8;
      --roughing-color: #8b4513;
      --finishing-color: #5a2d0c;
      --smoothing-color: #3d2108;
      --drawing-color: #ff5722;
      --refill-color: #795548;
    }

    body.dark {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --card-bg: #1e1e1e;
      --border-color: #444;
      --header-bg: linear-gradient(90deg, #2c2c2c, #444);
      --button-bg: #333;
      --button-hover: #555;
      --ai-color: #ba68c8;
      --wood-color: #a0522d;
      --tab-inactive: #333;
      --tab-active: #4a90e2;
      --analysis-color: #138496;
      --roughing-color: #a0522d;
      --finishing-color: #8b4513;
      --smoothing-color: #5a2d0c;
      --drawing-color: #ff8a65;
      --refill-color: #8d6e63;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      transition: all 0.3s ease;
      padding: 0;
      margin: 0;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 1rem;
      text-align: center;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1400px;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .controls {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    #themeToggle {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--header-text);
      transition: transform 0.3s;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #themeToggle:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.2);
    }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø¨Ø§Øª */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: var(--tab-inactive);
      transition: all 0.3s;
      text-align: center;
      flex: 1;
      font-weight: 500;
    }

    .tab.active {
      background: var(--tab-active);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ø¨Ø§Øª */
    .upload-section {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      text-align: center;
      border: 1px solid var(--border-color);
    }

    .previews-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    @media (min-width: 992px) {
      .previews-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .preview-block {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid var(--border-color);
    }

    .preview-title {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary-color);
    }

    .preview-content {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }

    canvas {
      max-width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    #preview3d {
      width: 100%;
      height: 300px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      width: 100%;
      margin-top: 1rem;
    }

    .option-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .option-group label {
      font-size: 0.9rem;
      font-weight: 500;
    }

    input[type="range"] {
      width: 150px;
      accent-color: var(--primary-color);
    }

    .settings-panel {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .settings-group {
      margin-bottom: 1.5rem;
    }

    .settings-group h3 {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-group select, 
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background: var(--bg-color);
      color: var(--text-color);
    }

    .gcode-output {
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 5px;
      padding: 15px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 1rem;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--secondary-color);
    }

    .btn-secondary {
      background: var(--button-bg);
      color: var(--text-color);
    }

    .btn-secondary:hover {
      background: var(--button-hover);
    }

    .btn-ai {
      background: var(--ai-color);
      color: white;
    }

    .btn-ai:hover {
      background: #7b1fa2;
    }

    .btn-analysis {
      background: var(--analysis-color);
      color: white;
    }

    .btn-analysis:hover {
      background: #138496;
    }

    .btn-roughing {
      background: var(--roughing-color);
      color: white;
    }

    .btn-finishing {
      background: var(--finishing-color);
      color: white;
    }

    .btn-smoothing {
      background: var(--smoothing-color);
      color: white;
    }

    .btn-drawing {
      background: var(--drawing-color);
      color: white;
    }

    .btn-refill {
      background: var(--refill-color);
      color: white;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      padding: 1.5rem;
      color: var(--text-color);
      font-size: 0.9rem;
      border-top: 1px solid var(--border-color);
    }

    .image-enhancement {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .enhancement-btn {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background: var(--button-bg);
      color: var(--text-color);
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
    }

    .enhancement-btn:hover {
      background: var(--button-hover);
    }

    .loading {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      z-index: 100;
      border-radius: 8px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      background: var(--success-color);
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .notification.error {
      background: var(--error-color);
    }

    .notification.ai {
      background: var(--ai-color);
    }

    .notification.analysis {
      background: var(--analysis-color);
    }

    .ai-options {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .path-optimization {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .optimization-option {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .optimization-option input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    .progress-container {
      width: 100%;
      background-color: var(--border-color);
      border-radius: 5px;
      margin: 15px 0;
      display: none;
    }

    .progress-bar {
      width: 0%;
      height: 20px;
      background-color: var(--primary-color);
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    .edge-detection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .analysis-panel {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
      display: none;
    }

    .analysis-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .analysis-item {
      background: var(--bg-color);
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .analysis-item h4 {
      margin-bottom: 0.5rem;
      color: var(--analysis-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .analysis-value {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .gcode-preview {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: æé€Ÿ4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: æé€Ÿ1px solid var(--border-color);
      display: none;
    }

    .gcode-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .stat-item {
      background: var(--bg-color);
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .stat-item h4 {
     æé€Ÿmargin-bottom: 0.5rem;
      color: var(--primary-color);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .wood-stages {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .wood-stage {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      border: 1px solid var(--border-color);
    }

    .wood-stage h3 {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .advanced-settings {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .path-preview {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .path-preview-content {
      width: 100%;
      height: 300px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--bg-color);
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-top: 1rem;
      position: relative;
      overflow: hidden;
    }

    .path-sæé€Ÿvg {
      width: 100%;
      height: 100%;
    }

    .path-controls {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      justify-content: center;
    }

    .drawing-tools {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin: 1rem 0;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 8æé€Ÿ;
      border: 1px solid var(--border-color);
    }

    .drawing-controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .drawing-instructions {
      font-size: 0.9rem;
      color: var(--text-color);
      text-align: center;
      margin-top: 0.5rem;
    }

    .drawing-canvas-container {
      position: relative;
      width: 100%;
      height: 300px;
      margin-top: 1rem;
    }

    #drawingCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: crosshair;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }

    .manual-selection {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,æé€Ÿ0.05);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .filename-input {
      margin-top: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filename-input input {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background: var(--bg-color);
      color: var(--text-color);
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.4rem;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
      }
      
      .preview-block {
        padding: 1rem;
      }
      
      .options {
        flex-direction: column;
        align-items: center;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .analysis-results, .gcode-stats {
        grid-template-columns: 1fr;
      }

      .wood-stages {
        grid-template-columns: 1fr;
      }

      .drawing-controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div classæé€Ÿ="header-content">
      <h1><span>ğŸ› ï¸</span> CNC AI - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©</h1>
      <div class="controls">
        <button id="themeToggle">ğŸŒ™</button>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Ø§Ù„ØªØ§Ø¨Ø§Øª -->
    <div class="tabs">
      <div class="tab active" data-tab="preview">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©</div>
      <div class="tab" data-tab="gcode">G-code Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      <div class="tab" data-tab="advanced">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</div>
    </div>

    <!-- ØªØ§Ø¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
    <div class="tab-content active" id="preview-tab">
      <section class="upload-section">
        <h2 class="upload-title">ğŸ“¤ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</h2>
        <div class="file-upload">
          <input type="file" id="fileInput" accept="image/*">
          <label for="fileInput"><span>ğŸ“</span> Ø§Ø®ØªØ± ØµÙˆØ±Ø©</label>
          <div class="file-name" id="fileName">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯</div>
        </div>

        <div class="progress-container" id="progressContainer">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="image-enhancement">
          <div class="enhancement-btn" onclick="applyEnhancement('brightness')">ğŸ”† Ø³Ø·ÙˆØ¹</div>
          <div class="enhancement-btn" onclick="applyEnhancement('contrast')">ğŸŒ“ ØªØ¨Ø§ÙŠÙ†</div>
          <div class="enhancement-btn" onclick="applyEnhancement('sharpen')">ğŸ” Ø­Ø¯Ø©</div>
          <div class="enhancement-btn" onclick="applyEnhancement('smooth')">ğŸ”„ Ù†Ø¹ÙˆÙ…Ø©</div>
          <div class="enhancement-btn" onclick="applyEnhancement('grayscale')">âš« ØªØ¯Ø±Ø¬ Ø±Ù…Ø§Ø¯ÙŠ</div>
          <div class="enhancement-btn" onclick="applyEnhancement('reset')">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</div>
        </div>

        <div class="edge-detection">
          <div class="enhancement-btn" onclick="detectEdges('sobel')">ğŸ” ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù (Sobel)</div>
          <div class="enhancement-btn" onclick="detectEdges('canny')">ğŸ” ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù (Canny)</div>
          <div class="enhancement-btn" onclick="detectEdges('laplacian')">ğŸ” ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù (Laplacian)</div>
        </div>
      </section>

      <div class="previews-container">
        <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© -->
        <div class="preview-block">
          <h3 class="preview-title">ğŸ“· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</h3>
          <div class="preview-content">
            <canvas id="preview2d"></canvas>
          </div>
        </div>

        <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© 3D -->
        <div class="preview-block">
          <h3 class="preview-title">ğŸŒ€ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</h3>
          <div class="preview-content">
            <div id="preview3d">
              <div class="loading" id="loading3d">
                <div class="loading-spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...</p>
              </div>
            </div>
          </div>
          <div class="options">
            <div class="option-group">
              <label for="rotationSpeed">ğŸ”„ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†</label>
              <input type="range" id="rotationSpeed" min="0" max="0.05" step="0.001" value="0.01">
            </div>
            <div class="option-group">
              <label for="zoomControl">ğŸ” Ø²ÙˆÙ…</label>
              <input type="range" id="zoomControl" min="50" max="500" step="10" value="200">
            </div>
            <div class="option-group">
              <label for="heightIntensity">ğŸ“ Ø´Ø¯Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label>
              <input type="range" id="heightIntensity" min="20" max="200" step="5" value="80">
            </div>
          </div>
        </div>

        <!-- Heatmap -->
        <div class="preview-block">
          <h3 class="preview-title">ğŸŒˆ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª (Heatmap)</h3>
          <div class="preview-content">
            <canvas id="heatmap"></canvas>
          </div>
          <div class="colormap-controls">
            <button class="btn btn-secondary" onclick="setColormap('jet')"><span>ğŸŒˆ</span> Jet</button>
            <button class="btn btn-secondary" onclick="setColormap('hot')"><span>ğŸ”¥</span> Hot</button>
            <button class="btn btn-secondary" onclick="setColormap('cool')"><span>â„ï¸</span> Cool</button>
            <button class="btn btn-secondary" onclick="setColormap('gray')"><span>âšª</span> Gray</button>
          </div>
        </div>

        <!-- Ø­ÙˆØ§Ù Ø§Ù„ØµÙˆØ±Ø© -->
        <div class="preview-block">
          <h3 class="preview-title">ğŸ” Ø­ÙˆØ§Ù Ø§Ù„ØµÙˆØ±Ø©</h3>
          <div class="preview-content">
            <canvas id="edgesCanvas"></canvas>
          </div>
          <div class="options">
            <div class="option-group">
              <label for="edgeThreshold">ğŸ“Š Ø¹ØªØ¨Ø© Ø§Ù„Ø­ÙˆØ§Ù</label>
              <input type="range" id="edgeThreshold" min="1" max="100" step="1" value="50" oninput="updateEdgeDetection()">
            </div>
          </div>
        </div>

        <!-- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙŠØ¯ÙˆÙŠØ§Ù‹ -->
        <div class="preview-block">
          <h3 class="preview-title">âœï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
          <div class="preview-content">
            <div class="drawing-canvas-container">
              <canvas id="drawingCanvas"></canvas>
            </div>
          </div>
          <div class="drawing-tools">
            <div class="drawing-controls">
              <button class="btn btn-drawing" id="startDrawing">
                <span>âœï¸</span> Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…
              </button>
              <button class="btn btn-secondary" id="clearDrawing">
                <span>ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ù…
              </button>
              <button class="btn btn-primary" id="applyDrawing">
                <span>âœ…</span> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù…
              </button>
            </div>
            <div class="drawing-instructions">
              <p>Ø§Ø±Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ù‚Ø·Ø¹Ù‡Ø§. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…ØŒ Ø«Ù… Ø§Ù†Ù‚Ø± ÙˆØ§Ø³Ø­Ø¨ Ù„Ø±Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©.</p>
            </div>
            <div class="options">
              <div class="option-group">
                <label for="brushSize">ğŸ“ Ø­Ø¬Ù… Ø§Ù„ÙØ±Ø´Ø§Ø©</label>
                <input type="range" id="brushSize" min="1" max="20" step="1" value="5">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ØªØ§Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª G-code -->
    <div class="tab-content" id="gcode-tab">
      <div class="ai-options">
        <h3><span>ğŸ¤–</span> Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
        <div class="path-optimization">
          <div class="optimization-option">
            <input type="checkbox" id="optimizePaths" checked>
            <label for="optimizePaths">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù„ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ù‚Ø·Ø¹</label>
          </div>
          <div class="optimization-option">
            <input type="checkbox" id="smoothEdges" checked>
            <label for="smoothEdges">ØªÙ†Ø¹ÙŠÙ… Ø§Ù„Ø­ÙˆØ§Ù Ù„Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£ÙØ¶Ù„</label>
          </div>
          <div class="optimization-option">
            <input type="checkbox" id="adaptivePrecision">
            <label for="adaptivePrecision">Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ØªÙƒÙŠÙÙŠØ© (ØªÙ„Ù‚Ø§Ø¦ÙŠØ©)</label>
          </æé€Ÿdiv>
          <div class="optimization-option">
            <input type="checkbox" id="useEdges" checked>
            <label for="useEdges">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­ÙˆØ§Ù Ø§Ù„ØµÙˆØ±Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</label>
          </div>
          <div class="optimization-option">
            <input type="checkbox" id="useHeatmap" checked>
            <label for="useHeatmap">Ø§Ø³ØªØ®Ø¯Ø§Ù… Heatmap Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</label>
          </div>
          <div class="optimization-option">
            <æé€Ÿinput type="checkbox" id="startFromEdges" checked>
            <label for="startFromEdges">Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø·Ø¹ Ù…Ù† Ø§Ù„Ø­ÙˆØ§Ù</label>
          </div>
          <div class="optimization-option">
            <input type="checkbox" id="useManualSelection">
            <label for="useManualSelection">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…Ù†Ø§Ø·Ù‚</label>
          </div>
          <div class="optimization-option">
            <input type="checkbox" id="useRefillMode">
            <label for="useRefillMode">ÙˆØ¶Ø¹ Ø§Ù„Ù€ Refill (Ù„Ù„Ø®Ø´Ø¨ ÙÙ‚Ø·)</label>
          </div>
        </div>
      </div>

      <div class="settings-panel">
        <div class="settings-group">
          <h3><span>ğŸ­</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©</h3>
          <div class="form-group">
            <label for="machineType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©</label>
            <select id="machineType">
              <option value="cnc">CNC Router</option>
              <option value="laser">Laser Cutter</option>
              <option value="3dprinter">3D Printer</option>
            </select>
          </div>
        </div>

        <div class="settings-group">
          <h3><span>ğŸ“¦</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ù…Ø©</h3>
          <div class="form-group">
            <label for="materialType">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø©</label>
            <select id="materialType">
              <option value="wood">Ø®Ø´Ø¨</option>
              <option value="refill">Refill Ø®Ø´Ø¨</option>
              <option value="acrylic">Ø£ÙƒØ±ÙŠÙ„ÙŠÙƒ</option>
              <option value="aluminum">Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</option>
              <option value="steel">ØµÙ„Ø¨</option>
              <option value="pla">PLA (Ø¨Ù„Ø§Ø³ØªÙŠÙƒ)</option>
              <option value="abs">ABS (Ø¨Ù„Ø§Ø³ØªÙŠÙƒ)</option>
            </select>
          </div>
          <div class="form-group" id="refillSettings">
            <label for="refillDepth">Ø¹Ù…Ù‚ Ø§Ù„Ù€ Refill (mm)</label>
            <input type="number" id="refillDepth" value="5" step="0.1">
          </div>
        </div>

        <div class="settings-group">
          <h3><span>âš™ï¸</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø·Ø¹</h3>
          <div class="form-group">
            <label for="feedRate">Ø³Ø±Ø¹Ø© Ø§Ù„ØªØºØ°ÙŠØ© (mm/min)</label>
            <input type="number" id="feedRate" value="1000">
          </div>
          <div class="form-group">
            <label for="spindleSpeed">Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ØºØ²Ù„ (RPM)</label>
            <input type="number" id="spindleSpeed" value="10000">
          </div>
          <div class="form-group">
            <label foræé€Ÿ="cutDepth">Ø¹Ù…Ù‚ Ø§Ù„Ù‚Ø·Ø¹ (mm)</label>
            <input type="number" id="cutDepth" value="2" step="0.1">
          </div>
          <div class="form-group">
            <label for="passDepth">Ø¹Ù…Ù‚ Ø§Ù„ØªÙ…Ø±ÙŠØ±Ø© (mm)</label>
            <input type="number" id="passDepth" value="0.5" step="0.1">
          </div>
        </div>

        <div class="settings-group">
          <h3><span>ğŸ”§</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª G-code</h3>
          <div class="form-group">
            <label for="gcodeType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª</label>
            <select id="gcodeæé€ŸType">
              <option value="heatmap">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Heatmap</option>
              <option value="3dmodel">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</option>
              <option value="edges">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙˆØ§Ù</option>
              <option value="manual">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="precision">Ø§Ù„Ø¯Ù‚Ø© (mm)</label>
            <input type="number" id="precision" value="0.1" step="0.01">
          </div>
          <div class="form-group">
            <label for="toolDiameter">Ù‚Ø·Ø± Ø§Ù„Ø£Ø¯Ø§Ø© (mm)</label>
            <input type="number" id="toolDiameter" value="3.175" step="0.01">
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" onclick="generateGcode()"><span>âš™ï¸</span> ØªÙˆÙ„ÙŠØ¯ G-code</button>
        <button class="btn btn-secondary" onclick="simulateCutting()"><span>ğŸ¬</span> Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù‚Ø·Ø¹</button>
        <button class="btn btn-secondary" onclick="saveGcode()"><span>ğŸ’¾</span> Ø­ÙØ¸ G-code</button>
        <button class="btn btn-analysis" onclick="analyzeGcode()"><span>ğŸ“Š</span> ØªØ­Ù„ÙŠÙ„ G-code</button>
      </div>

      <div class="gcode-output" id="gcodeOutput">
        // G-code Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§
      </div>

      <div class="analysis-panel" id="analysisPanel">
        <h3><span>ğŸ“Š</span> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„</h3>
        <div class="analysis-results">
          <div class="analysis-item">
            <h4><span>â±ï¸</span> Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h4>
            <div class="analysis-value" id="estimatedTime">--:--</div>
          </div>
          <div class="analysis-item">
            <h4><span>ğŸ“</span> Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h4>
            <div class="analysis-value" id="totalLength">0 mm</div>
          </div>
          <div class="analysis-item">
            <h4><span>ğŸ”„</span> Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±Ø§Øª</h4>
            <div class="analysis-value" id="passCount">0</div>
          </div>
          <div class="analysis-item">
            <h4><span>âš¡</span> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø·Ø§Ù‚Ø©</h4>
            <div class="analysis-value" id="powerUsage">0 kWh</div>
          </div>
        </div>
      </div>

      <div class="gcode-preview" id="gcodePreview">
        <h3><span>ğŸ“‹</span> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª G-code</h3>
        <div class="gcode-stats">
          <div class="stat-item">
            <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±</h4>
            <div class="stat-value" id="lineCount">0</div>
          </div>
          <div class="stat-item">
            <h4>Ø£Ø³Ø±Ø¹ Ø­Ø±ÙƒØ©</h4>
            <div class="stat-value" id="fastestMove">0 mm/min</div>
          </div>
          <div class="stat-item">
            <h4>Ø£Ø¨Ø·Ø£ Ø­Ø±ÙƒØ©</h4>
            <div class="stat-value" id="slowestMove">0 mm/min</div>
          </div>
          <div class="stat-item">
            <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø±Ø¹Ø©</h4>
            <div class="stat-value" id="averageSpeed">0 mm/min</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ØªØ§Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="tab-content" id="advanced-tab">
      <div class="advanced-settings">
        <h3><span>ğŸ”</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
        <div class="settings-group">
          <div class="form-group">
            <label for="contourLevels">Ø¹Ø¯Ø¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ÙƒÙ†ØªÙˆØ±</label>
            <input type="number" id="contourLevels" value="10" min="1" max="100">
          </div>
          <div class="form-group">
            <label for="contourSensitivity">Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ÙƒÙ†ØªÙˆØ±</label>
            <input type="range" id="contourSensitivity" min="1" max="100" value="50">
          </div>
          <div class="form-group">
            <label for="contourSmoothing">ØªÙ†Ø¹ÙŠÙ… Ø§Ù„ÙƒÙ†ØªÙˆØ±</label>
            <input type="range" id="contourSmoothing" min="1" max="100" value="30">
          </div>
        </div>
      </div>

      <div class="path-preview">
        <h3><span>ğŸ”„</span> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</h3>
        <div class="path-preview-content">
          <svg class="path-svg" id="pathSvg"></svg>
        </div>
        <div class="path-controls">
          <button class="btn btn-secondary" onclick="showAllPaths()"><span>ğŸ‘ï¸</span> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
          <button class="btn btn-secondary" onclick="showOptimalPath()"><span>ğŸ”</span> Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ù…Ø«Ù„</button>
          <button class="btn btn-secondary" onclick="showRoughingPath()"><span>ğŸªš</span> Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´ÙƒÙŠÙ„</button>
          <button class="btn btn-secondary" onclick="showFinishingPath()"><span>âœ¨</span> Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´Ø·ÙŠØ¨</button>
        </div>
      </div>

      <div class="manual-selection">
        <h3><span>âœ‹</span> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ù‚Ø·Ø¹Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù….</p>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="startManualSelection()"><span>âœï¸</span> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
          <button class="btn btn-secondary" onclick="clearManualSelection()"><span>ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
          <button class="btn btn-primary" onclick="applyManualSelection()"><span>âœ…</span> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
        </div>
      </div>

      <div class="wood-stages">
        <div class="wood-stage">
          <h3><span>ğŸªš</span> Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„ (Roughing)</h3>
          <div class="form-group">
            <label for="roughingTool">Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„</label>
            <select id="roughingTool">
              <option value="6mm">6mm End Mill</option>
              <option value="8mm">8mm End Mill</option>
              <option value="10mm">10mm End Mill</option>
              <option value="12mm">12mm End Mill</option>
            </select>
          </div>
          <div class="form-group">
            <label for="roughingStepover">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„ (%)</label>
            <input type="number" id="roughingStepover" value="50" min="10" max="80">
          </div>
          <div class="form-group">
            <label for="roughingDepth">Ø¹Ù…Ù‚ Ø§Ù„Ù‚Ø·Ø¹ (mm)</label>
            <input type="number" id="roughingDepth" value="2" step="0.1">
          </div>
          <button class="btn btn-roughing" onclick="generateRoughingPath()"><span>ğŸ”„</span> ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´ÙƒÙŠÙ„</button>
        </div>

        <div class="wood-stage">
          <h3><span>âœ¨</span> Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ´Ø·ÙŠØ¨ (Finishing)</h3>
          <div class="form-group">
            <label for="finishingTool">Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ´Ø·ÙŠØ¨</label>
            <select id="finishingTool">
              <option value="3mm">3mm Ball Nose</option>
              <option value="4mm">4mm Ball Nose</option>
              <option value="6mm">6mm Ball Nose</option>
              <option value="8mm">8mm Ball Nose</option>
            </select>
          </div>
          <div class="form-group">
            <label for="finishingStepover">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„ (%)</label>
            <input type="number" id="finishingStepover" value="10" min="5" max="30">
          </div>
          <div class="form-group">
            <label for="finishingDepth">Ø¹Ù…Ù‚ Ø§Ù„Ù‚Ø·Ø¹ (mm)</label>
            <input type="number" id="finishingDepth" value="0.5" step="0.1">
          </div>
          <button class="btn btn-finishing" onclick="generateFinishingPath()"><span>ğŸ”„</span> ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´Ø·ÙŠØ¨</button>
        </div>

        <div class="wood-stage">
          <h3><span>ğŸ”</span> Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ†Ø¹ÙŠÙ… (Smoothing)</h3>
          <div class="form-group">
            <label for="smoothingTool">Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ†Ø¹ÙŠÙ…</label>
            <select id="smoothingTool">
              <option value="1mm">1mm Ball Nose</option>
              <option value="2mm">2mm Ball Nose</option>
              <option value="3mm">3mm Ball Nose</option>
            </select>
          </div>
          <div class="form-group">
            <label for="smoothingStepover">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„ (%)</label>
            <input type="number" id="smoothingStepover" value="5" min="2" max="15">
          </div>
          <div class="form-group">
            <label for="smoothingDepth">Ø¹Ù…Ù‚ Ø§Ù„Ù‚Ø·Ø¹ (mm)</label>
            <input type="number" id="smoothingDepth" value="0.2" step="0.05">
          </div>
          <button class="btn btn-smoothing" onclick="generateSmoothingPath()"><span>ğŸ”„</span> ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ø¹ÙŠÙ…</button>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" onclick="generateAllPaths()"><span>âš™ï¸</span> ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
        <button class="btn btn-secondary" onclick="simulateAllPaths()"><span>ğŸ¬</span> Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
        <button class="btn btn-secondary" onclick="exportAllPaths()"><span>ğŸ’¾</span> ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
        <button class="btn btn-analysis" onclick="analyzeAllPaths()"><span>ğŸ“Š</span> ØªØ­Ù„ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</button>
      </div>
    </div>
  </div>

  <footer>
    <p>CNC AI - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© Ù…Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© | ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… HTML5, CSS3 Ùˆ JavaScript</p>
  </footer>

  <div class="notification" id="notification">
    <span id="notificationMessage"></span>
  </div>

  <script>
    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    let originalImage = null;
    let currentImage = null;
    let modifiedImage = null;
    let edgesImage = null;
    let isDrawing = false;
    let isManualSelection = false;
    let drawingPoints = [];
    let manualSelectionPoints = [];
    let gcodeData = null;
    let currentColormap = 'jet';
    let threeDScene = null;
    let threeDRenderer = null;
    let threeDCamera = null;
    let threeDModel = null;
    let is3DInitialized = false;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      initializeTabs();
      initializeDrawingCanvas();
      initializeEventListeners();
      initialize3DViewer();
      updateSliderValues();
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ§Ø¨Ø§Øª
    function initializeTabs() {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          activateTab(tabId);
        });
      });
    }

    // ØªÙØ¹ÙŠÙ„ ØªØ§Ø¨ Ù…Ø¹ÙŠÙ†
    function activateTab(tabId) {
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });

      // Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ§Ø¨Ø§Øª
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
      document.getElementById(`${tabId}-tab`).classList.add('active');
      document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
    }

    // ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù…
    function initializeDrawingCanvas() {
      const canvas = document.getElementById('drawingCanvas');
      const ctx = canvas.getContext('2d');
      
      // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù…
      const startDrawingBtn = document.getElementById('startDrawing');
      const clearDrawingBtn = document.getElementById('clearDrawing');
      const applyDrawingBtn = document.getElementById('applyDrawing');
      const brushSize = document.getElementById('brushSize');
      
      startDrawingBtn.addEventListener('click', () => {
        isDrawing = true;
        startDrawingBtn.textContent = 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø³Ù…';
        startDrawingBtn.classList.remove('btn-drawing');
        startDrawingBtn.classList.add('btn-secondary');
      });
      
      clearDrawingBtn.addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawingPoints = [];
      });
      
      applyDrawingBtn.addEventListener('click', () => {
        isDrawing = false;
        startDrawingBtn.textContent = 'âœï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…';
        startDrawingBtn.classList.remove('btn-secondary');
        startDrawingBtn.classList.add('btn-drawing');
        applyDrawingToImage();
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø±Ø³Ù…
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„ÙØ±Ø´Ø§Ø©
      brushSize.addEventListener('input', () => {
        ctx.lineWidth = brushSize.value;
      });
      
      // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
      ctx.lineWidth = brushSize.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…
    function startDrawing(e) {
      if (!isDrawing) return;
      
      const canvas = document.getElementById('drawingCanvas');
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      drawingPoints.push({x, y});
      
      const ctx = canvas.getContext('2d');
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    // Ø§Ù„Ø±Ø³Ù…
    function draw(e) {
      if (!isDrawing) return;
      
      const canvas = document.getElementById('drawingCanvas');
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      drawingPoints.push({x, y});
      
      const ctx = canvas.getContext('2d');
      ctx.lineTo(x, y);
      ctx.stroke();
    }

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø³Ù…
    function stopDrawing() {
      if (!isDrawing) return;
      
      const ctx = document.getElementById('drawingCanvas').getContext('2d');
      ctx.closePath();
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
    function applyDrawingToImage() {
      if (drawingPoints.length === 0) {
        showNotification('Ù„Ù… ØªÙ‚Ù… Ø¨Ø±Ø³Ù… Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø©', 'error');
        return;
      }
      
      showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©', 'success');
      // Ù‡Ù†Ø§ Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
    }

    // ØªÙ‡ÙŠØ¦Ø© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function initializeEventListeners() {
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
      const fileInput = document.getElementById('fileInput');
      fileInput.addEventListener('change', handleFileUpload);
      
      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±
      const themeToggle = document.getElementById('themeToggle');
      themeToggle.addEventListener('click', toggleTheme);
      
      // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø§Øª
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        slider.addEventListener('input', updateSliderValues);
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Refill
      const materialType = document.getElementById('materialType');
      materialType.addEventListener('change', updateRefillSettings);
      
      // ØªØ­Ø¯ÙŠØ« ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù
      const edgeThreshold = document.getElementById('edgeThreshold');
      edgeThreshold.addEventListener('input', updateEdgeDetection);
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø§Øª
    function updateSliderValues() {
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        const valueDisplay = document.getElementById(`${slider.id}Value`);
        if (valueDisplay) {
          valueDisplay.textContent = slider.value;
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Refill
    function updateRefillSettings() {
      const materialType = document.getElementById('materialType').value;
      const refillSettings = document.getElementById('refillSettings');
      
      if (materialType === 'refill') {
        refillSettings.style.display = 'block';
      } else {
        refillSettings.style.display = 'none';
      }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const themeToggle = document.getElementById('themeToggle');
      
      if (document.body.classList.contains('dark')) {
        themeToggle.textContent = 'â˜€ï¸';
      } else {
        themeToggle.textContent = 'ğŸŒ™';
      }
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const fileName = document.getElementById('fileName');
      fileName.textContent = file.name;
      
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      
      progressContainer.style.display = 'block';
      
      // Ù…Ø­Ø§ÙƒØ§Ø© ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„
      let progress = 0;
      const interval = setInterval(() => {
        progress += 5;
        progressBar.style.width = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(interval);
          progressContainer.style.display = 'none';
          loadImage(file);
        }
      }, 50);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
    function loadImage(file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          originalImage = img;
          currentImage = img;
          displayImage(img);
          showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        };
        img.src = e.target.result;
      };
      
      reader.readAsDataURL(file);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
    function displayImage(img) {
      const canvas = document.getElementById('preview2d');
      const ctx = canvas.getContext('2d');
      
      // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
      canvas.width = 500;
      canvas.height = (img.height / img.width) * 500;
      
      // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø©
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
      modifiedImage = document.createElement('canvas');
      modifiedImage.width = canvas.width;
      modifiedImage.height = canvas.height;
      const modifiedCtx = modifiedImage.getContext('2d');
      modifiedCtx.drawImage(img, 0, 0, canvas.width, canvas.height);
      
      // Ø¥Ù†Ø´Ø§Ø¡ Heatmap
      generateHeatmap();
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø­ÙˆØ§Ù Ø§Ù„ØµÙˆØ±Ø©
      detectEdges('sobel');
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
      update3DView();
    }

    // ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
    function applyEnhancement(type) {
      if (!currentImage) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      const canvas = document.getElementById('preview2d');
      const ctx = canvas.getContext('2d');
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imgData.data;
      
      switch(type) {
        case 'brightness':
          // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø·ÙˆØ¹
          for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] + 30);
            data[i+1] = Math.min(255, data[i+1] + 30);
            data[i+2] = Math.min(255, data[i+2] + 30);
          }
          break;
        case 'contrast':
          // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§ÙŠÙ†
          const factor = 1.5;
          for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));
            data[i+1] = Math.min(255, Math.max(0, factor * (data[i+1] - 128) + 128));
            data[i+2] = Math.min(255, Math.max(0, factor * (data[i+2] - 128) + 128));
          }
          break;
        case 'sharpen':
          // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯Ø©
          // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Sharpen Ø§Ù„Ø¨Ø³ÙŠØ·
          const tempCanvas = document.createElement('canvas');
          const tempCtx = tempCanvas.getContext('2d');
          tempCanvas.width = canvas.width;
          tempCanvas.height = canvas.height;
          tempCtx.putImageData(imgData, 0, 0);
          
          ctx.filter = 'contrast(1.2) saturate(1.2)';
          ctx.drawImage(tempCanvas, 0, 0);
          ctx.filter = 'none';
          return;
        case 'smooth':
          // ØªÙ†Ø¹ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø©
          ctx.filter = 'blur(1px)';
          ctx.drawImage(canvas, 0, 0);
          ctx.filter = 'none';
          return;
        case 'grayscale':
          // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØªØ¯Ø±Ø¬ Ø±Ù…Ø§Ø¯ÙŠ
          for (let i = 0; i < data.length; i += 4) {
            const avg = (data[i] + data[i+1] + data[i+2]) / 3;
            data[i] = avg;
            data[i+1] = avg;
            data[i+2] = avg;
          }
          break;
        case 'reset':
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙˆØ±Ø©
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
          return;
      }
      
      ctx.putImageData(imgData, 0, 0);
      showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ${type} Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©`, 'success');
    }

    // ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù
    function detectEdges(type) {
      if (!currentImage) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      const canvas = document.getElementById('edgesCanvas');
      const ctx = canvas.getContext('2d');
      
      // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
      canvas.width = document.getElementById('preview2d').width;
      canvas.height = document.getElementById('preview2d').height;
      
      // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imgData.data;
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù
      switch(type) {
        case 'sobel':
          applySobel(data, canvas.width, canvas.height);
          break;
        case 'canny':
          applyCanny(data, canvas.width, canvas.height);
          break;
        case 'laplacian':
          applyLaplacian(data, canvas.width, canvas.height);
          break;
      }
      
      ctx.putImageData(imgData, 0, 0);
      edgesImage = canvas.toDataURL();
      showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ${type} Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­ÙˆØ§Ù`, 'success');
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Sobel
    function applySobel(data, width, height) {
      // ØªØ·Ø¨ÙŠÙ‚ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Sobel Ù„ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù
      // Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶
      
      const sobelData = new Uint8ClampedArray(data.length);
      
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          const i = (y * width + x) * 4;
          
          // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¯Ø±Ø¬ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ X
          let gx = 
            -1 * getRed(data, width, x-1, y-1) + 
            1 * getRed(data, width, x+1, y-1) +
            -2 * getRed(data, width, x-1, y) +
            2 * getRed(data, width, x+1, y) +
            -1 * getRed(data, width, x-1, y+1) +
            1 * getRed(data, width, x+1, y+1);
          
          // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¯Ø±Ø¬ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Y
          let gy = 
            -1 * getRed(data, width, x-1, y-1) +
            -2 * getRed(data, width, x, y-1) +
            -1 * getRed(data, width, x+1, y-1) +
            1 * getRed(data, width, x-1, y+1) +
            2 * getRed(data, width, x, y+1) +
            1 * getRed(data, width, x+1, y+1);
          
          // Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù… Ø§Ù„ØªØ¯Ø±Ø¬
          const magnitude = Math.min(255, Math.sqrt(gx * gx + gy * gy));
          
          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¨ÙƒØ³Ù„
          sobelData[i] = magnitude;
          sobelData[i+1] = magnitude;
          sobelData[i+2] = magnitude;
          sobelData[i+3] = 255;
        }
      }
      
      // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      for (let i = 0; i < data.length; i++) {
        data[i] = sobelData[i];
      }
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Canny
    function applyCanny(data, width, height) {
      // ØªØ·Ø¨ÙŠÙ‚ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Canny Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
      // Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶
      
      // Ø£ÙˆÙ„Ø§Ù‹: ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Gaussian Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
      applyGaussian(data, width, height);
      
      // Ø«Ø§Ù†ÙŠØ§Ù‹: Ø§Ø³ØªØ®Ø¯Ø§Ù… Sobel Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­ÙˆØ§Ù
      applySobel(data, width, height);
      
      // Ø«Ø§Ù„Ø«Ø§Ù‹: ØªØ·Ø¨ÙŠÙ‚ Non-Maximum Suppression
      // (Ù…ØªØ¨Ø³ÙŠØ· Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶)
      
      // Ø±Ø§Ø¨Ø¹Ø§Ù‹: ØªØ·Ø¨ÙŠÙ‚ Hysteresis Thresholding
      // (Ù…ØªØ¨Ø³ÙŠØ· Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶)
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Laplacian
    function applyLaplacian(data, width, height) {
      // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Laplacian Ø§Ù„Ù…Ø¨Ø³Ø·
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          const i = (y * width + x) * 4;
          
          const laplacian = 
            -1 * getRed(data, width, x-1, y-1) +
            -1 * getRed(data, width, x, y-1) +
            -1 * getRed(data, width, x+1, y-1) +
            -1 * getRed(data, width, x-1, y) +
            8 * getRed(data, width, x, y) +
            -1 * getRed(data, width, x+1, y) +
            -1 * getRed(data, width, x-1, y+1) +
            -1 * getRed(data, width, x, y+1) +
            -1 * getRed(data, width, x+1, y+1);
          
          const magnitude = Math.min(255, Math.max(0, laplacian));
          
          data[i] = magnitude;
          data[i+1] = magnitude;
          data[i+2] = magnitude;
          data[i+3] = 255;
        }
      }
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Gaussian
    function applyGaussian(data, width, height) {
      // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø´Ø­ Gaussian Ø§Ù„Ù…Ø¨Ø³Ø·
      const kernel = [1, 2, 1, 2, 4, 2, 1, 2, 1];
      const kernelSize = 3;
      const kernelSum = 16;
      
      const tempData = new Uint8ClampedArray(data.length);
      
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          let r = 0, g = 0, b = 0;
          
          for (let ky = -1; ky <= 1; ky++) {
            for (let kx = -1; kx <= 1; kx++) {
              const ki = (ky + 1) * kernelSize + (kx + 1);
              const i = ((y + ky) * width + (x + kx)) * 4;
              
              r += data[i] * kernel[ki];
              g += data[i+1] * kernel[ki];
              b += data[i+2] * kernel[ki];
            }
          }
          
          const i = (y * width + x) * 4;
          tempData[i] = r / kernelSum;
          tempData[i+1] = g / kernelSum;
          tempData[i+2] = b / kernelSum;
          tempData[i+3] = data[i+3];
        }
      }
      
      // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      for (let i = 0; i < data.length; i++) {
        data[i] = tempData[i];
      }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£Ø­Ù…Ø± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function getRed(data, width, x, y) {
      const i = (y * width + x) * 4;
      return data[i];
    }

    // ØªØ­Ø¯ÙŠØ« ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù
    function updateEdgeDetection() {
      if (!edgesImage) return;
      
      const threshold = document.getElementById('edgeThreshold').value;
      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹ØªØ¨Ø© Ø¹Ù„Ù‰ Ø­ÙˆØ§Ù Ø§Ù„ØµÙˆØ±Ø©
      // (Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ØªÙŠ ÙŠØªÙ… ÙÙŠÙ‡Ø§ ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ù)
      detectEdges('sobel');
    }

    // ØªÙˆÙ„ÙŠØ¯ Heatmap
    function generateHeatmap() {
      if (!currentImage) return;
      
      const canvas = document.getElementById('heatmap');
      const ctx = canvas.getContext('2d');
      
      // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
      canvas.width = document.getElementById('preview2d').width;
      canvas.height = document.getElementById('preview2d').height;
      
      // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imgData.data;
      
      // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØªØ¯Ø±Ø¬ Ø±Ù…Ø§Ø¯ÙŠ
      for (let i = 0; i < data.length; i += 4) {
        const avg = (data[i] + data[i+1] + data[i+2]) / 3;
        data[i] = avg;
        data[i+1] = avg;
        data[i+2] = avg;
      }
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
      applyColormap(data, currentColormap);
      
      ctx.putImageData(imgData, 0, 0);
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    function applyColormap(data, colormap) {
      for (let i = 0; i < data.length; i += 4) {
        const value = data[i]; // Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ
        
        let r, g, b;
        
        switch(colormap) {
          case 'jet':
            // Ø®Ø±ÙŠØ·Ø© Ø£Ù„ÙˆØ§Ù† Jet
            r = Math.min(255, Math.max(0, 255 * Math.sin(0.03 * value)));
            g = Math.min(255, Math.max(0, 255 * Math.sin(0.03 * value + 1)));
            b = Math.min(255, Math.max(0, 255 * Math.sin(0.03 * value + 2)));
            break;
          case 'hot':
            // Ø®Ø±ÙŠØ·Ø© Ø£Ù„ÙˆØ§Ù† Hot
            r = Math.min(255, value * 2);
            g = Math.min(255, Math.max(0, value * 2 - 128));
            b = Math.min(255, Math.max(0, value * 2 - 255));
            break;
          case 'cool':
            // Ø®Ø±ÙŠØ·Ø© Ø£Ù„ÙˆØ§Ù† Cool
            r = value;
            g = 255 - value;
            b = 255;
            break;
          case 'gray':
          default:
            // Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ (Ù„Ø§ ØªØºÙŠÙŠØ±)
            r = value;
            g = value;
            b = value;
            break;
        }
        
        data[i] = r;
        data[i+1] = g;
        data[i+2] = b;
      }
    }

    // ØªØ¹ÙŠÙŠÙ† Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    function setColormap(colormap) {
      currentColormap = colormap;
      generateHeatmap();
      showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† ${colormap}`, 'success');
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
    function initialize3DViewer() {
      // Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
      // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Three.js Ø£Ùˆ Ù…ÙƒØªØ¨Ø© Ù…Ù…Ø§Ø«Ù„Ø©
      const preview3d = document.getElementById('preview3d');
      preview3d.innerHTML = '<p>Ø§Ù„Ø¹Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</p>';
      is3DInitialized = true;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
    function update3DView() {
      if (!currentImage || !is3DInitialized) return;
      
      const preview3d = document.getElementById('preview3d');
      preview3d.innerHTML = `
        <div style="text-align: center; padding: 20px;">
          <p>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯...</p>
          <div class="loading-spinner" style="margin: 0 auto;"></div>
        </div>
      `;
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
      setTimeout(() => {
        preview3d.innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <p>âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­</p>
            <p>Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</p>
          </div>
        `;
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯', 'success');
      }, 2000);
    }

    // ØªÙˆÙ„ÙŠØ¯ G-code
    function generateGcode() {
      if (!currentImage) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      showNotification('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ G-code...', 'ai');
      
      // Ù…Ø­Ø§ÙƒØ§Ø© ØªÙˆÙ„ÙŠØ¯ G-code
      setTimeout(() => {
        const gcodeOutput = document.getElementById('gcodeOutput');
        gcodeOutput.textContent = `
; G-code generated by CNC AI
; Date: ${new Date().toLocaleString()}
; Image: ${document.getElementById('fileName').textContent}
; Material: ${document.getElementById('materialType').value}
; Tool Diameter: ${document.getElementById('toolDiameter').value} mm

G21 ; Set to millimeters
G90 ; Absolute positioning
G94 ; Units per minute feed rate

; Start cutting
G0 X0 Y0 Z5
G1 Z-${document.getElementById('cutDepth').value} F${document.getElementById('feedRate').value / 2}
G1 X10 Y10 F${document.getElementById('feedRate').value}
G1 X90 Y10
G1 X90 Y90
G1 X10 Y90
G1 X10 Y10
G0 Z5

; Finish cutting
G0 X0 Y0
M30 ; End program
        `.trim();
        
        gcodeData = gcodeOutput.textContent;
        
        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
        document.getElementById('analysisPanel').style.display = 'block';
        document.getElementById('gcodePreview').style.display = 'block';
        
        // ØªØ­Ø¯ÙŠØ« Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        document.getElementById('estimatedTime').textContent = '00:15:30';
        document.getElementById('totalLength').textContent = '520 mm';
        document.getElementById('passCount').textContent = '1';
        document.getElementById('powerUsage').textContent = '0.8 kWh';
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª G-code
        document.getElementById('lineCount').textContent = '15';
        document.getElementById('fastestMove').textContent = '1000 mm/min';
        document.getElementById('slowestMove').textContent = '500 mm/min';
        document.getElementById('averageSpeed').textContent = '750 mm/min';
        
        showNotification('ØªÙ… ØªÙˆÙ„ÙŠØ¯ G-code Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }, 3000);
    }

    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù‚Ø·Ø¹
    function simulateCutting() {
      if (!gcodeData) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ G-code Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      showNotification('Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù‚Ø·Ø¹...', 'analysis');
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
      setTimeout(() => {
        showNotification('ØªÙ…Øª Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù‚Ø·Ø¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }, 2000);
    }

    // Ø­ÙØ¸ G-code
    function saveGcode() {
      if (!gcodeData) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ G-code Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      const fileName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:', `cnc_ai_${new Date().getTime()}.gcode`);
      if (!fileName) return;
      
      const blob = new Blob([gcodeData], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù G-code', 'success');
    }

    // ØªØ­Ù„ÙŠÙ„ G-code
    function analyzeGcode() {
      if (!gcodeData) {
        showNotification('ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ G-code Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }
      
      showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ G-code...', 'analysis');
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
      setTimeout(() => {
        showNotification('ØªÙ… ØªØ­Ù„ÙŠÙ„ G-code Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }, 2000);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const notificationMessage = document.getElementById('notificationMessage');
      
      notificationMessage.textContent = message;
      notification.className = 'notification';
      notification.classList.add(type);
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    function startManualSelection() {
      isManualSelection = true;
      showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ', 'success');
    }

    function clearManualSelection() {
      manualSelectionPoints = [];
      showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ', 'success');
    }

    function applyManualSelection() {
      if (manualSelectionPoints.length === 0) {
        showNotification('Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø©', 'error');
        return;
      }
      
      showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ', 'success');
    }

    function generateRoughingPath() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´ÙƒÙŠÙ„...', 'roughing');
    }

    function generateFinishingPath() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´Ø·ÙŠØ¨...', 'finishing');
    }

    function generateSmoothingPath() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ø¹ÙŠÙ…...', 'smoothing');
    }

    function generateAllPaths() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª...', 'ai');
    }

    function simulateAllPaths() {
      showNotification('Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª...', 'analysis');
    }

    function exportAllPaths() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª...', 'success');
    }

    function analyzeAllPaths() {
      showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª...', 'analysis');
    }

    function showAllPaths() {
      showNotification('Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª', 'success');
    }

    function showOptimalPath() {
      showNotification('Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ù…Ø«Ù„', 'success');
    }

    function showRoughingPath() {
      showNotification('Ø¹Ø±Ø¶ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´ÙƒÙŠÙ„', 'roughing');
    }

    function showFinishingPath() {
      showNotification('Ø¹Ø±Ø¶ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ´Ø·ÙŠØ¨', 'finishing');
    }
  </script>
</body>
</html>
