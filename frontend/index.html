<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>CncAi</title>
  <style>
    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background: #f4f4f4;
      color: #222;
      direction: rtl;
    }

    header {
      background: #222;
      color: #fff;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 22px;
      margin: 0;
    }

    .container {
      display: flex;
      gap: 20px;
      padding: 20px;
    }

    .controls {
      flex: 1;
      max-width: 250px;
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .controls button, .controls input {
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #222;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
    }

    .controls button:hover {
      background: #444;
    }

    .viewer {
      flex: 3;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 500px;
      overflow: hidden;
    }

    canvas, img {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <header>
    <h1>CncAi - Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØµÙ…ÙŠÙ…</h1>
    <span>âœ¨ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø°ÙƒÙŠØ© Ù„Ù„ØªØµØ§Ù…ÙŠÙ… Ù‚Ø¨Ù„ Ø§Ù„Ù€ CNC</span>
  </header>

  <div class="container">
    <div class="controls">
      <input type="file" id="upload" accept="image/*">
      <button onclick="setView('original')">ğŸ“· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</button>
      <button onclick="setView('2d')">ğŸ–¼ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© 2D</button>
      <button onclick="setView('heatmap')">ğŸŒˆ Heatmap</button>
      <button onclick="setView('3d')">ğŸ”² Ù…Ø¹Ø§ÙŠÙ†Ø© 3D</button>
      <button onclick="zoomIn()">â• ØªÙƒØ¨ÙŠØ±</button>
      <button onclick="zoomOut()">â– ØªØµØºÙŠØ±</button>
      <button onclick="rotate()">âŸ³ ØªØ¯ÙˆÙŠØ±</button>
      <button onclick="generateGcode()">âš™ï¸ ØªÙˆÙ„ÙŠØ¯ G-code</button>
    </div>

    <div class="viewer" id="viewer">
      <p>ğŸ“Œ Ø­Ù…Ù‘Ù„ ØµÙˆØ±Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    let currentView = null;
    let uploadedImage = null;
    let scale = 1, rotation = 0;

    const viewer = document.getElementById("viewer");

    // Ø±ÙØ¹ ØµÙˆØ±Ø©
    document.getElementById("upload").addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.onload = () => {
        uploadedImage = img;
        setView("original");
      };
    });

    function clearViewer() {
      viewer.innerHTML = "";
    }

    function setView(type) {
      if (!uploadedImage) return alert("ğŸ“Œ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹!");
      currentView = type;
      clearViewer();

      if (type === "original") {
        viewer.appendChild(uploadedImage);
      }

      if (type === "2d") {
        const canvas = document.createElement("canvas");
        canvas.width = uploadedImage.width;
        canvas.height = uploadedImage.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImage, 0, 0);
        viewer.appendChild(canvas);
      }

      if (type === "heatmap") {
        const canvas = document.createElement("canvas");
        canvas.width = uploadedImage.width * 1.3; // ØªÙƒØ¨ÙŠØ± Ø´ÙˆÙŠØ©
        canvas.height = uploadedImage.height * 1.3;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImage, 0, 0, canvas.width, canvas.height);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < imageData.data.length; i += 4) {
          let brightness = (imageData.data[i] + imageData.data[i+1] + imageData.data[i+2]) / 3;
          imageData.data[i] = brightness; // R
          imageData.data[i+1] = 50;       // G Ø«Ø§Ø¨Øª
          imageData.data[i+2] = 255 - brightness; // B
        }
        ctx.putImageData(imageData, 0, 0);
        viewer.appendChild(canvas);
      }

      if (type === "3d") {
        init3D();
      }
    }

    function init3D() {
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, viewer.clientWidth / viewer.clientHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(viewer.clientWidth, viewer.clientHeight);
      viewer.appendChild(renderer.domElement);

      const geometry = new THREE.PlaneGeometry(5, 5, 100, 100);
      const material = new THREE.MeshStandardMaterial({ color: 0x888888, side: THREE.DoubleSide, wireframe: false });
      const plane = new THREE.Mesh(geometry, material);
      scene.add(plane);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 5, 5).normalize();
      scene.add(light);

      camera.position.z = 8;
      const controls = new THREE.OrbitControls(camera, renderer.domElement);

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    }

    function zoomIn() {
      scale += 0.1;
      viewer.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
    }

    function zoomOut() {
      scale = Math.max(0.5, scale - 0.1);
      viewer.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
    }

    function rotate() {
      rotation += 15;
      viewer.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
    }

    function generateGcode() {
      alert("âš™ï¸ ØªÙˆÙ„ÙŠØ¯ G-code (Ù‚Ø±ÙŠØ¨Ù‹Ø§)");
    }
  </script>
</body>
</html>
