<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D & 3D Preview</title>
  <style>
    body { font-family: Arial; text-align: center; margin: 0; padding: 0; }
    canvas { border: 1px solid #ccc; margin: 10px; }
    #viewer { width: 600px; height: 400px; margin: auto; }
  </style>
</head>
<body>
  <h2>معاينة 2D و 3D</h2>
  <input type="file" id="fileInput" accept="image/*"><br><br>
  <button onclick="show2D()">عرض 2D</button>
  <button onclick="show3D()">عرض 3D</button>
  
  <canvas id="canvas2D" width="600" height="400"></canvas>
  <div id="viewer"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/controls/OrbitControls.js"></script>
  
  <script>
    let img = new Image();
    let imgLoaded = false;

    document.getElementById('fileInput').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        img.onload = () => { imgLoaded = true; show2D(); };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    function show2D() {
      if (!imgLoaded) return alert("ارفع صورة أولاً");
      const ctx = document.getElementById('canvas2D').getContext('2d');
      ctx.clearRect(0, 0, 600, 400);
      ctx.drawImage(img, 0, 0, 600, 400);
    }

    function show3D() {
      if (!imgLoaded) return alert("ارفع صورة أولاً");

      const viewer = document.getElementById("viewer");
      viewer.innerHTML = ""; // مسح القديم

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, viewer.clientWidth / viewer.clientHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(viewer.clientWidth, viewer.clientHeight);
      viewer.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);

      // إضاءة
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(0, 1, 1).normalize();
      scene.add(light);

      // خامة من الصورة
      const texture = new THREE.TextureLoader().load(img.src);
      const geometry = new THREE.PlaneGeometry(6, 4);
      const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
      const plane = new THREE.Mesh(geometry, material);
      scene.add(plane);

      camera.position.z = 8;

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    }
  </script>
</body>
</html>
