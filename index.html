<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CncAi - Light UI</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      background: #f9f9f9;
      color: #333;
    }

    header {
      background: #fff;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      color: #0078d7;
    }

    .controls {
      display: flex;
      gap: 10px;
    }

    .controls button, .controls input[type=file] {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.3s;
    }

    .controls input[type=file] {
      background: #e6f0ff;
      color: #0078d7;
    }

    .controls button {
      background: #0078d7;
      color: #fff;
    }

    .controls button:hover {
      background: #005fa3;
    }

    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .preview-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .preview-card h2 {
      font-size: 16px;
      background: #f0f4f8;
      margin: 0;
      padding: 10px;
      border-bottom: 1px solid #eee;
      color: #555;
    }

    .preview-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
    }

    .preview-content canvas, 
    .preview-content img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>
    <h1>CncAi - Light Mode</h1>
    <div class="controls">
      <input type="file" id="upload" accept="image/*">
      <button onclick="setView('original')">الأصلية</button>
      <button onclick="setView('2d')">معاينة 2D</button>
      <button onclick="setView('heatmap')">Heatmap</button>
      <button onclick="setView('3d')">معاينة 3D</button>
    </div>
  </header>

  <main>
    <div class="preview-card">
      <h2>المعاينة</h2>
      <div class="preview-content" id="preview-area">
        <p>قم برفع صورة لبدء المعاينة</p>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    let currentView = 'original';
    let uploadedImg = null;

    const upload = document.getElementById('upload');
    const previewArea = document.getElementById('preview-area');

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedImg = new Image();
          uploadedImg.src = event.target.result;
          uploadedImg.onload = () => setView(currentView);
        };
        reader.readAsDataURL(file);
      }
    });

    function setView(view) {
      currentView = view;
      previewArea.innerHTML = "";

      if (!uploadedImg) {
        previewArea.innerHTML = "<p>قم برفع صورة لعرض المعاينة</p>";
        return;
      }

      if (view === 'original') {
        previewArea.appendChild(uploadedImg.cloneNode());
      } 
      else if (view === '2d') {
        const canvas = document.createElement("canvas");
        canvas.width = uploadedImg.width;
        canvas.height = uploadedImg.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImg, 0, 0);
        previewArea.appendChild(canvas);
      } 
      else if (view === 'heatmap') {
        const canvas = document.createElement("canvas");
        canvas.width = uploadedImg.width;
        canvas.height = uploadedImg.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImg, 0, 0);
        let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < imgData.data.length; i += 4) {
          let avg = (imgData.data[i] + imgData.data[i+1] + imgData.data[i+2]) / 3;
          imgData.data[i] = avg; // R
          imgData.data[i+1] = 0; // G
          imgData.data[i+2] = 255 - avg; // B
        }
        ctx.putImageData(imgData, 0, 0);
        previewArea.appendChild(canvas);
      } 
      else if (view === '3d') {
        const width = 400, height = 400;
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(width, height);
        previewArea.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        const canvas = document.createElement("canvas");
        canvas.width = uploadedImg.width;
        canvas.height = uploadedImg.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImg, 0, 0);
        let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

        const geometry = new THREE.PlaneGeometry(10, 10, canvas.width-1, canvas.height-1);
        for (let i = 0; i < geometry.attributes.position.count; i++) {
          let x = i % canvas.width;
          let y = Math.floor(i / canvas.width);
          let idx = (y * canvas.width + x) * 4;
          let brightness = (imgData.data[idx] + imgData.data[idx+1] + imgData.data[idx+2]) / 3;
          geometry.attributes.position.setZ(i, brightness/50);
        }
        geometry.computeVertexNormals();

        const texture = new THREE.CanvasTexture(canvas);
        const material = new THREE.MeshStandardMaterial({ map: texture, side: THREE.DoubleSide });
        const mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(1,1,1);
        scene.add(light);

        camera.position.z = 15;

        function animate() {
          requestAnimationFrame(animate);
          controls.update();
          renderer.render(scene, camera);
        }
        animate();
      }
    }
  </script>
</body>
</html>
