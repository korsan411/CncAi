<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D & 3D Preview</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; text-align: center; }
    #controls { margin: 20px; }
    #preview2d, #preview3d { display: none; margin: auto; }
    canvas { border: 1px solid #ccc; background: #fff; }
  </style>
</head>
<body>
  <h1>Image CNC Preview</h1>
  <input type="file" id="upload" accept="image/*">
  
  <div id="controls">
    <button onclick="show2D()">عرض 2D</button>
    <button onclick="show3D()">عرض 3D</button>
  </div>

  <!-- 2D Preview -->
  <canvas id="preview2d" width="500" height="400"></canvas>

  <!-- 3D Preview -->
  <div id="preview3d" style="width:500px; height:400px;"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    const upload = document.getElementById('upload');
    const canvas2d = document.getElementById('preview2d');
    const ctx2d = canvas2d.getContext('2d');
    const container3d = document.getElementById('preview3d');
    let scene, camera, renderer, mesh;

    // إظهار 2D
    function show2D() {
      canvas2d.style.display = 'block';
      container3d.style.display = 'none';
    }

    // إظهار 3D
    function show3D() {
      canvas2d.style.display = 'none';
      container3d.style.display = 'block';
      if (!renderer) init3D();
    }

    // تحميل الصورة للمعاينة 2D + 3D
    upload.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      img.onload = () => {
        // رسم 2D
        ctx2d.clearRect(0, 0, canvas2d.width, canvas2d.height);
        ctx2d.drawImage(img, 0, 0, canvas2d.width, canvas2d.height);

        // 3D texture
        const texture = new THREE.Texture(img);
        texture.needsUpdate = true;
        if (mesh) scene.remove(mesh);

        const geometry = new THREE.PlaneGeometry(4, 3);
        const material = new THREE.MeshBasicMaterial({ map: texture });
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);
      };
      img.src = URL.createObjectURL(file);
    });

    function init3D() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(45, 500/400, 0.1, 100);
      camera.position.z = 5;

      renderer = new THREE.WebGLRenderer();
      renderer.setSize(500, 400);
      container3d.appendChild(renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(1, 1, 1);
      scene.add(light);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      if (mesh) mesh.rotation.y += 0.01;
      renderer.render(scene, camera);
    }

    // بدء العرض الافتراضي
    show2D();
  </script>
</body>
</html>
